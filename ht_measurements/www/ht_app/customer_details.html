{% extends "templates/web.html" %}

{% block title %}{{ _("Customer Details") }}{% endblock %}

{% block page_content %}
<div class="container mt-5">
    <div class="card shadow-lg p-4">
        <h5 class="card-title text-center">{{ _("Customer Details") }}</h5>
        <form id="customer-details-form">
            <div class="form-group">
                <label for="name1">{{ _("Name:") }}</label>
                <input type="text" id="name1" name="name1" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="delivery_date">{{ _("Delivery Date:") }}</label>
                <input type="date" id="delivery_date" name="delivery_date" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="gender">{{ _("Gender:") }}</label>
                <select id="gender" name="gender" class="form-control" required>
                    <option value="Male">{{ _("Male") }}</option>
                    <option value="Female">{{ _("Female") }}</option>
                    <option value="Transgender">{{ _("Transgender") }}</option>
                    <option value="Others">{{ _("Others") }}</option>
                </select>
            </div>
            <div class="form-group">
                <label for="invoice_number">{{ _("Invoice Number:") }}</label>
                <input type="text" id="invoice_number" name="invoice_number" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="trial_date">{{ _("Trial Date:") }}</label>
                <input type="date" id="trial_date" name="trial_date" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="phone_number">{{ _("Phone Number:") }}</label>
                <input type="text" id="phone_number" name="phone_number" class="form-control">
            </div>
            <button type="submit" class="btn btn-primary btn-block">{{ _("Submit") }}</button>
        </form>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("customer-details-form").addEventListener("submit", function (e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = {};
        formData.forEach((value, key) => {
            data[key] = value;
        });
        
        frappe.call({
            method: "frappe.client.insert",
            args: {
                doc: {
                    doctype: "HT Invoice",
                    name1: data.name1,
                    delivery_date: data.delivery_date,
                    gender: data.gender,
                    invoice_number: data.invoice_number,
                    trial_date: data.trial_date,
                    store: new URLSearchParams(window.location.search).get('store')
                }
            },
            callback: function (r) {
                if (r.message) {
                    window.location.href = `/ht_app/measurements?invoice_number=${data.invoice_number}`;
                } else {
                    alert("There was an error saving the customer details. Please try again.");
                }
            }
        });
    });
});
</script>
{% endblock %}
